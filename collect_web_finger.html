<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµè§ˆå™¨ä¿¡æ¯é‡‡é›†Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .control-panel {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        button {
            padding: 12px 24px;
            font-size: 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #45a049;
        }
        
        button.secondary {
            background: #2196F3;
        }
        
        button.secondary:hover {
            background: #0b7dda;
        }
        
        .output-area {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            margin-top: 20px;
            max-height: 500px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .summary {
            background: #e8f5e9;
            border: 1px solid #c8e6c9;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .summary h3 {
            color: #2e7d32;
            margin-bottom: 10px;
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ æµè§ˆå™¨ä¿¡æ¯é‡‡é›†æ¼”ç¤º</h1>
        
        <div class="control-panel">
            <button id="collectBtn" onclick="startCollection()">å¼€å§‹é‡‡é›†ä¿¡æ¯</button>
            <button class="secondary" onclick="showSummary()">æ˜¾ç¤ºæ‘˜è¦</button>
            <button class="secondary" onclick="clearOutput()">æ¸…ç©ºè¾“å‡º</button>
            <button onclick="exportJSON()">å¯¼å‡ºJSON</button>
        </div>
        
        <div id="status" class="status"></div>
        
        <div class="summary" id="summaryContainer" style="display: none;">
            <h3>ğŸ“Š ä¿¡æ¯æ‘˜è¦</h3>
            <div id="summaryContent"></div>
        </div>
        
        <div class="output-area" id="output">
            ç‚¹å‡»"å¼€å§‹é‡‡é›†ä¿¡æ¯"æŒ‰é’®æŸ¥çœ‹æµè§ˆå™¨è¯¦ç»†ä¿¡æ¯...
        </div>
    </div>

    <script>
        // æµè§ˆå™¨ä¿¡æ¯é‡‡é›†å™¨ç±»
        class BrowserInfoCollector {
            constructor() {
                this.collectedData = {};
            }
            
            // ä¸»æ”¶é›†æ–¹æ³•
            async collectAllInfo() {
                console.log('å¼€å§‹æ”¶é›†æµè§ˆå™¨ä¿¡æ¯...\n');
                
                try {
                    // åŒæ­¥æ”¶é›†çš„ä¿¡æ¯
                    this.collectedData.basic = this.collectBasicInfo();
                    this.collectedData.screen = this.collectScreenInfo();
                    this.collectedData.navigator = this.collectNavigatorInfo();
                    this.collectedData.webgl = this.collectWebGLInfo();
                    this.collectedData.canvas = this.collectCanvasInfo();
                    this.collectedData.fonts = await this.collectFontsInfo();
                    this.collectedData.battery = await this.collectBatteryInfo();
                    this.collectedData.network = this.collectNetworkInfo();
                    this.collectedData.storage = this.collectStorageInfo();
                    this.collectedData.plugins = this.collectPluginsInfo();
                    this.collectedData.performance = this.collectPerformanceInfo();
                    this.collectedData.time = this.collectTimeInfo();
                    
                    // æ·»åŠ æ—¶é—´æˆ³å’Œç‰ˆæœ¬
                    this.collectedData.meta = {
                        collectionTime: new Date().toISOString(),
                        version: '1.0',
                        timestamp: Date.now()
                    };
                    
                    console.log('âœ… ä¿¡æ¯æ”¶é›†å®Œæˆï¼');
                    
                } catch (error) {
                    console.error('âŒ æ”¶é›†è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯:', error);
                    this.collectedData.error = error.message;
                }
                
                return this.collectedData;
            }
            
            // 1. åŸºæœ¬æµè§ˆå™¨ä¿¡æ¯
            collectBasicInfo() {
                return {
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    language: navigator.language,
                    languages: navigator.languages || [],
                    vendor: navigator.vendor || 'unknown',
                    cookieEnabled: navigator.cookieEnabled,
                    doNotTrack: navigator.doNotTrack || 'unknown',
                    maxTouchPoints: navigator.maxTouchPoints || 0,
                    hardwareConcurrency: navigator.hardwareConcurrency || 0,
                    deviceMemory: navigator.deviceMemory || 'unknown'
                };
            }
            
            // 2. å±å¹•ä¿¡æ¯
            collectScreenInfo() {
                return {
                    width: screen.width,
                    height: screen.height,
                    availWidth: screen.availWidth,
                    availHeight: screen.availHeight,
                    colorDepth: screen.colorDepth,
                    pixelDepth: screen.pixelDepth,
                    ms_moz_Orientation: screen.msOrientation ||
                          screen.mozOrientation || '',
                    orientation: screen.orientation ? {
                        type: screen.orientation.type,
                        angle: screen.orientation.angle
                    } : 'not supported'
                };
            }
            
            // 3. å¯¼èˆªå™¨æ‰©å±•ä¿¡æ¯
            collectNavigatorInfo() {
                return {
                    product: navigator.product,
                    appName: navigator.appName,
                    appVersion: navigator.appVersion,
                    appCodeName: navigator.appCodeName,
                    onLine: navigator.onLine,
                    geolocation: 'geolocation' in navigator,
                    serviceWorker: 'serviceWorker' in navigator,
                    webdriver: navigator.webdriver || false,
                    pdfViewerEnabled: navigator.pdfViewerEnabled || false
                };
            }
            
            // 4. WebGLä¿¡æ¯
            collectWebGLInfo() {
                const result = {
                    supported: false,
                    extensions: [],
                    renderer: null,
                    vendor: null
                };
                
                try {
                    const canvas = document.createElement('canvas');
                    const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                    
                    if (gl) {
                        result.supported = true;
                        
                        // è·å–æ‰©å±•åˆ—è¡¨
                        const extensions = gl.getSupportedExtensions();
                        result.extensions = extensions || [];
                        
                        // è·å–æ¸²æŸ“å™¨ä¿¡æ¯
                        const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                        if (debugInfo) {
                            result.renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
                            result.vendor = gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL);
                        }
                        
                        // åŸºç¡€ä¿¡æ¯
                        result.version = gl.getParameter(gl.VERSION);
                        result.shadingLanguageVersion = gl.getParameter(gl.SHADING_LANGUAGE_VERSION);
                        result.maxTextureSize = gl.getParameter(gl.MAX_TEXTURE_SIZE);
                    }
                } catch (e) {
                    result.error = e.message;
                }
                
                return result;
            }
            
            // 5. CanvasæŒ‡çº¹
            collectCanvasInfo() {
                const result = {
                    supported: false,
                    fingerprint: null
                };
                
                try {
                    const canvas = document.createElement('canvas');
                    canvas.width = 200;
                    canvas.height = 50;
                    const ctx = canvas.getContext('2d');
                    
                    if (ctx) {
                        result.supported = true;
                        
                        // ç»˜åˆ¶ä¸€äº›å†…å®¹
                        ctx.fillStyle = 'rgb(255, 0, 0)';
                        ctx.fillRect(10, 10, 50, 50);
                        
                        ctx.fillStyle = 'rgba(0, 0, 255, 0.5)';
                        ctx.font = '18px Arial';
                        ctx.fillText('Canvas Test', 70, 30);
                        
                        // è·å–å›¾åƒæ•°æ®
                        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
                        
                        // ç”Ÿæˆç®€å•æŒ‡çº¹ï¼ˆå‰100ä¸ªåƒç´ å€¼ä¹‹å’Œï¼‰
                        let sum = 0;
                        for (let i = 0; i < Math.min(100, imageData.length); i++) {
                            sum += imageData[i];
                        }
                        result.fingerprint = sum;
                        
                        // æµ‹è¯•åŠŸèƒ½æ”¯æŒ
                        result.features = {
                            text: !!ctx.fillText,
                            shadow: !!ctx.shadowBlur,
                            gradient: !!ctx.createLinearGradient,
                            imageSmoothing: ctx.imageSmoothingEnabled
                        };
                    }
                } catch (e) {
                    result.error = e.message;
                }
                
                return result;
            }
            
            // 6. å­—ä½“æ£€æµ‹
            async collectFontsInfo() {
                const result = {
                    detectedFonts: [],
                    totalCount: 0
                };
                
                try {
                    // å¸¸è§å­—ä½“åˆ—è¡¨
                    const commonFonts = [
                        'Arial', 'Arial Black', 'Arial Narrow', 
                        'Times New Roman', 'Times', 
                        'Courier New', 'Courier',
                        'Verdana', 'Georgia', 
                        'Palatino', 'Garamond',
                        'Bookman', 'Comic Sans MS',
                        'Trebuchet MS', 'Impact',
                        'Tahoma', 'Geneva',
                        'Helvetica', 'Helvetica Neue',
                        'Lucida Console', 'Lucida Sans Unicode',
                        'MS Sans Serif', 'MS Serif',
                        'Symbol', 'Webdings',
                        'Wingdings', 'Wingdings 2', 'Wingdings 3'
                    ];
                    
                    // æ£€æµ‹å“ªäº›å­—ä½“å¯ç”¨
                    const availableFonts = [];
                    
                    // åˆ›å»ºæµ‹è¯•å…ƒç´ 
                    const testElement = document.createElement('span');
                    testElement.style.fontSize = '40px';
                    testElement.style.position = 'absolute';
                    testElement.style.left = '-9999px';
                    testElement.innerHTML = 'mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm';
                    document.body.appendChild(testElement);
                    
                    // è·å–é»˜è®¤å®½åº¦
                    const defaultWidth = testElement.offsetWidth;
                    const defaultHeight = testElement.offsetHeight;
                    
                    // æµ‹è¯•æ¯ä¸ªå­—ä½“
                    for (const font of commonFonts) {
                        testElement.style.fontFamily = `'${font}', monospace`;
                        
                        // æ£€æŸ¥å°ºå¯¸æ˜¯å¦å˜åŒ–
                        if (testElement.offsetWidth !== defaultWidth || testElement.offsetHeight !== defaultHeight) {
                            availableFonts.push(font);
                        }
                    }
                    
                    // æ¸…ç†
                    document.body.removeChild(testElement);
                    
                    result.detectedFonts = availableFonts;
                    result.totalCount = availableFonts.length;
                    
                } catch (e) {
                    result.error = e.message;
                }
                
                return result;
            }
            
            // 7. ç”µæ± ä¿¡æ¯
            async collectBatteryInfo() {
                const result = {
                    supported: false,
                    level: null,
                    charging: null
                };
                
                try {
                    if ('getBattery' in navigator) {
                        const battery = await navigator.getBattery();
                        result.supported = true;
                        result.level = Math.round(battery.level * 100); // ç™¾åˆ†æ¯”
                        result.charging = battery.charging;
                        result.chargingTime = battery.chargingTime;
                        result.dischargingTime = battery.dischargingTime;
                    }
                } catch (e) {
                    result.error = e.message;
                }
                
                return result;
            }
            
            // 8. ç½‘ç»œä¿¡æ¯
            collectNetworkInfo() {
                const result = {
                    online: navigator.onLine,
                    connection: null
                };
                
                try {
                    const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
                    
                    if (connection) {
                        result.connection = {
                            type: connection.type || 'unknown',
                            effectiveType: connection.effectiveType || 'unknown',
                            downlink: connection.downlink || 0,
                            downlinkMax: connection.downlinkMax || 0,
                            rtt: connection.rtt || 0,
                            saveData: connection.saveData || false
                        };
                    }
                } catch (e) {
                    result.error = e.message;
                }
                
                return result;
            }
            
            // 9. å­˜å‚¨ä¿¡æ¯
            collectStorageInfo() {
                return {
                    localStorage: !!window.localStorage,
                    sessionStorage: !!window.sessionStorage,
                    indexedDB: !!window.indexedDB,
                    cookies: navigator.cookieEnabled,
                    quota: 'storage' in navigator ? 'supported' : 'not supported'
                };
            }
            
            // 10. æ’ä»¶ä¿¡æ¯
            collectPluginsInfo() {
                const result = {
                    pluginCount: 0,
                    plugins: []
                };
                
                try {
                    if (navigator.plugins && navigator.plugins.length > 0) {
                        result.pluginCount = navigator.plugins.length;
                        
                        // æ”¶é›†æ’ä»¶ä¿¡æ¯ï¼ˆé™åˆ¶æ•°é‡ï¼‰
                        const pluginList = [];
                        for (let i = 0; i < Math.min(navigator.plugins.length, 10); i++) {
                            const plugin = navigator.plugins[i];
                            pluginList.push({
                                name: plugin.name,
                                description: plugin.description,
                                filename: plugin.filename,
                                length: plugin.length
                            });
                        }
                        result.plugins = pluginList;
                    }
                    
                    // MIMEç±»å‹
                    if (navigator.mimeTypes && navigator.mimeTypes.length > 0) {
                        result.mimeTypeCount = navigator.mimeTypes.length;
                    }
                } catch (e) {
                    result.error = e.message;
                }
                
                return result;
            }
            
            // 11. æ€§èƒ½ä¿¡æ¯
            collectPerformanceInfo() {
                const result = {
                    memory: null,
                    timing: null
                };
                
                try {
                    // å†…å­˜ä¿¡æ¯ï¼ˆChromeç­‰æµè§ˆå™¨ï¼‰
                    if (performance.memory) {
                        result.memory = {
                            usedJSHeapSize: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024) + ' MB',
                            totalJSHeapSize: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024) + ' MB',
                            jsHeapSizeLimit: Math.round(performance.memory.jsHeapSizeLimit / 1024 / 1024) + ' MB'
                        };
                    }
                    
                    // å¯¼èˆªè®¡æ—¶
                    if (performance.timing) {
                        const timing = performance.timing;
                        result.timing = {
                            pageLoadTime: timing.loadEventEnd - timing.navigationStart,
                            domReadyTime: timing.domContentLoadedEventEnd - timing.navigationStart,
                            redirectCount: performance.navigation.redirectCount || 0,
                            type: performance.navigation.type === 0 ? 'Normal navigation' : 
                                  performance.navigation.type === 1 ? 'Reload' : 'Back/Forward'
                        };
                    }
                } catch (e) {
                    result.error = e.message;
                }
                
                return result;
            }
            
            // 12. æ—¶é—´å’Œæ—¶åŒºä¿¡æ¯
            collectTimeInfo() {
                return {
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    timezoneOffset: new Date().getTimezoneOffset(),
                    locale: Intl.DateTimeFormat().resolvedOptions().locale,
                    dateString: new Date().toString(),
                    dateISOString: new Date().toISOString(),
                    now: Date.now(),
                    performanceNow: performance.now()
                };
            }
        }
        
        // å…¨å±€å‡½æ•°ï¼Œç”¨äºUIè°ƒç”¨
        window.getBrowserInfo = async function() {
            const collector = new BrowserInfoCollector();
            return await collector.collectAllInfo();
        };
        
        // çŠ¶æ€æ˜¾ç¤ºå‡½æ•°
        function showStatus(message, type = 'success') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = 'status ' + type;
        }
        
        // å¼€å§‹é‡‡é›†
        async function startCollection() {
            showStatus('æ­£åœ¨æ”¶é›†æµè§ˆå™¨ä¿¡æ¯...', 'success');
            document.getElementById('output').textContent = 'æ­£åœ¨æ”¶é›†...';
            
            try {
                const data = await window.getBrowserInfo();
                document.getElementById('output').textContent = JSON.stringify(data, null, 2);
                showStatus('âœ… ä¿¡æ¯æ”¶é›†å®Œæˆï¼', 'success');
                
                // ä¿å­˜åˆ°å…¨å±€å˜é‡ä»¥ä¾¿åç»­ä½¿ç”¨
                window.lastCollectionData = data;
                
            } catch (error) {
                document.getElementById('output').textContent = 'é”™è¯¯: ' + error.message;
                showStatus('âŒ æ”¶é›†å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // æ˜¾ç¤ºæ‘˜è¦
        function showSummary() {
            if (!window.lastCollectionData) {
                showStatus('è¯·å…ˆæ”¶é›†ä¿¡æ¯', 'error');
                return;
            }
            
            const data = window.lastCollectionData;
            const summaryContainer = document.getElementById('summaryContainer');
            const summaryContent = document.getElementById('summaryContent');
            
            let html = '';
            
            // åˆ›å»ºæ‘˜è¦ä¿¡æ¯
            if (data.basic) {
                html += `<p><strong>æµè§ˆå™¨:</strong> ${data.basic.userAgent.split(' ').slice(0, 3).join(' ')}</p>`;
                html += `<p><strong>å¹³å°:</strong> ${data.basic.platform}</p>`;
                html += `<p><strong>è¯­è¨€:</strong> ${data.basic.language}</p>`;
                html += `<p><strong>åœ¨çº¿çŠ¶æ€:</strong> ${data.basic.onLine ? 'åœ¨çº¿' : 'ç¦»çº¿'}</p>`;
            }
            
            if (data.screen) {
                html += `<p><strong>å±å¹•åˆ†è¾¨ç‡:</strong> ${data.screen.width} Ã— ${data.screen.height}</p>`;
                html += `<p><strong>å¯ç”¨åŒºåŸŸ:</strong> ${data.screen.availWidth} Ã— ${data.screen.availHeight}</p>`;
                html += `<p><strong>è‰²å½©æ·±åº¦:</strong> ${data.screen.colorDepth} ä½</p>`;
            }
            
            if (data.webgl) {
                html += `<p><strong>WebGLæ”¯æŒ:</strong> ${data.webgl.supported ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ'}</p>`;
            }
            
            if (data.canvas) {
                html += `<p><strong>Canvasæ”¯æŒ:</strong> ${data.canvas.supported ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ'}</p>`;
            }
            
            if (data.fonts) {
                html += `<p><strong>æ£€æµ‹åˆ°å­—ä½“æ•°:</strong> ${data.fonts.totalCount || 0}</p>`;
            }
            
            if (data.network && data.network.connection) {
                html += `<p><strong>ç½‘ç»œç±»å‹:</strong> ${data.network.connection.effectiveType}</p>`;
                html += `<p><strong>ä¸‹è¡Œé€Ÿåº¦:</strong> ${data.network.connection.downlink} Mbps</p>`;
            }
            
            if (data.time) {
                html += `<p><strong>æ—¶åŒº:</strong> ${data.time.timezone}</p>`;
            }
            
            if (data.battery) {
                html += `<p><strong>ç”µæ± æ”¯æŒ:</strong> ${data.battery.supported ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ'}</p>`;
                if (data.battery.supported) {
                    html += `<p><strong>ç”µæ± ç”µé‡:</strong> ${data.battery.level}%</p>`;
                    html += `<p><strong>å……ç”µçŠ¶æ€:</strong> ${data.battery.charging ? 'å……ç”µä¸­' : 'æœªå……ç”µ'}</p>`;
                }
            }
            
            if (data.meta) {
                html += `<p><strong>æ”¶é›†æ—¶é—´:</strong> ${data.meta.collectionTime}</p>`;
            }
            
            summaryContent.innerHTML = html;
            summaryContainer.style.display = 'block';
            showStatus('æ‘˜è¦ä¿¡æ¯å·²æ˜¾ç¤º', 'success');
        }
        
        // æ¸…ç©ºè¾“å‡º
        function clearOutput() {
            document.getElementById('output').textContent = 'è¾“å‡ºå·²æ¸…ç©º';
            document.getElementById('summaryContainer').style.display = 'none';
            showStatus('è¾“å‡ºå·²æ¸…ç©º', 'success');
        }
        
        // å¯¼å‡ºJSON
        function exportJSON() {
            if (!window.lastCollectionData) {
                showStatus('è¯·å…ˆæ”¶é›†ä¿¡æ¯', 'error');
                return;
            }
            
            const dataStr = JSON.stringify(window.lastCollectionData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'browser-info-' + Date.now() + '.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showStatus('JSONæ–‡ä»¶å·²ä¸‹è½½', 'success');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œä¸€æ¬¡
        document.addEventListener('DOMContentLoaded', function() {
            // 5ç§’åè‡ªåŠ¨è¿è¡Œ
            setTimeout(function() {
                document.getElementById('output').textContent = 'é¡µé¢å·²åŠ è½½ï¼Œå¯ä»¥å¼€å§‹é‡‡é›†ä¿¡æ¯...';
            }, 1000);
        });
    </script>
</body>
</html>
